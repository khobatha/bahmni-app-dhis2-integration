<html>
<head>
<title>DHIS2 Integration App</title>
<!--STYLESHEETS AND FONTS-->
<link rel="stylesheet" href="../bower_components/nepali-date-picker/dist/nepaliDatePicker.min.css">
<link rel="stylesheet" href="../css/stylesheet.css">
<link rel="stylesheet" href="../bower_components/jquery-ui/themes/base/jquery-ui.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<!--LIBRARIES-->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script src="../bower_components/jquery.min/index.js"></script>
<script src="../bower_components/jquery-ui/jquery-ui.min.js"></script>

<!--PLUGINS-->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="../bower_components/mustache.min/index.js"></script>
<script src="../js/spinner.js"></script>
<script src="../js/initAutomation.js"></script>
<script src="../bower_components/nepali-date-picker/dist/jquery.nepaliDatePicker.min.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<link rel="stylesheet" href="/resources/demos/style.css">
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script>
	$( function() {
	  $( "#start-date" ).datepicker();
	  
	  // Generate schedule when button is clicked
	  $('#generate-schedule').click(function(event){
		  event.preventDefault();
		  // Get start date value
		  var startDate = moment($('#start-date').val());
		  if($('#start-date').val() && startDate.month()==7){
  
			  // Create an array to store the schedule
			  var schedule = [];
  
			  // Add the first submission date to the schedule
			  schedule.push(startDate.format("YYYY-MM-DDTHH:mm"));
  
			  // Loop through each subsequent date, adding 4 weeks at a time, until the end of the reporting period in July
			  while ( startDate.month() != 6) {
				  console.log('------------------start--------------------');
				  console.log(startDate.format("MMM"));
				  console.log(startDate.format("YYYY-MM-DDTHH:mm"));
				  console.log('-------------------end---------------------');
				  startDate =  startDate.add(4, 'weeks');
				  schedule.push(startDate.format("YYYY-MM-DDTHH:mm"));
			  }
  
			  // Display the schedule on the page and populate the submission
							  // Create a table to display the schedule
			  var table = '<table><tr><th>Period</th><th>Date</th><th>Period</th><th>Date</th><th>Period</th><th>Date</th></tr>';
  
			  // Loop through each submission date in the schedule and add it to the table
			  for (var i = 0; i < schedule.length; i+=3) {
				  var submissionDate_1 = moment(schedule[i]);
				  formattedDate_1=submissionDate_1.format('YYYY-MM-DDTHH:mm');
				  var submissionDate_2 = moment(schedule[i+1]);
				  formattedDate_2=submissionDate_2.format('YYYY-MM-DDTHH:mm');
				  var submissionDate_3 = moment(schedule[i+2]);
				  formattedDate_3=submissionDate_2.format('YYYY-MM-DDTHH:mm');
				  if(i==12)
					  table += '<td>' + parseInt(i+1) + '</td><td><input type="datetime-local" class="form-control" id="' + i + '" value="' + formattedDate_1 + '"></td></tr>';
				  else{
					  table += '<tr><td>' + parseInt(i+1) + '</td><td><input type="datetime-local" class="form-control" id="' + i + '" value="' + formattedDate_1 + '"></td>';
					  table += '<td>' + parseInt(i+2) + '</td><td><input type="datetime-local" class="form-control" id="' + i+1 + '" value="' + formattedDate_2 + '"></td>';
					  table += '<td>' + parseInt(i+3) + '</td><td><input type="datetime-local" class="form-control" id="' + i+2 + '" value="' + formattedDate_3 + '"></td></tr>';
				  }
				  
			  }
  
			  table += '</table>';
  
			  // Add the table to the page
			  $('#schedule').html(table);
		  }else{
			  console.log('The datetime value is null or empty.');
		  }
		  
	  });
	  
	} );
	</script>
	<script>
		$( function() {
			const modal = document.getElementById("addMonthlyScheduleModal");
			const modalContent = document.getElementById("addMonthlyScheduleModalContent");

			function adjustModalWidth() {
				// calculate the required width based on the content inside the modal
				const requiredWidth = modalContent.scrollWidth + 20; // add some padding

				// set the width of the modal's container element
				modal.style.width = requiredWidth + "px";
			}

			function addAdjustAddMonthlyScheduleModalHandler(){
				// call the adjustModalWidth function whenever the modal is shown or the content inside the modal changes
				modal.addEventListener("show", adjustModalWidth);
				modalContent.addEventListener("change", adjustModalWidth);
			}

		});
		
	</script>

</head>
<body>
	<div class="header">
		<div class="dhisTitleWrapper">
			<div class="home">
				<a href="/bahmni/home" class="btn header-link">Home</a>
			</div>
			<div class="home">
				<a href="../index.html" class="btn header-link">Manual</a>
			</div>
            <div class="home">
				<a href="#" class="btn header-link">Automation</a>
			</div>
		</div>
	</div>

	<div class="dhisWrapper">
		<div id="tabs">
			<ul id="scheduler-tabs" class="nav nav-tabs">
				<li class="nav-item"><a href="#tab-weekly" class="nav-link active" data-toggle="tab">Weekly</a></li>
				<li class="nav-item"><a href="#tab-monthly" class="nav-link" data-toggle="tab">Monthly</a></li>
				<li class="nav-item"><a href="#tab-quarterly" class="nav-link" data-toggle="tab">Quarterly</a></li>
			</ul>
			<div id="tab-weekly" class="tab-pane fade show active">
					<div class="container-xl">
						<div class="table-responsive">
							<div class="table-wrapper">
								<div class="table-title">
									<div class="row">
										<div class="col-sm-6">
											<h2>List of Weekly Schedules</h2>
										</div>
										<div class="col-sm-6">
											<a href="#addWeeklyScheduleModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>New</span></a>
											<a href="#deleteWeeklyScheduleModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a>
										</div>
									</div>
								</div>
								<table class="table table-striped table-hover" id="weekly-program-schedules">
									<thead>
										<tr>
											<th>
											</th>
											<th>Program</th>
											<th>Last Run</th>
											<th>Status</th>
											<th>On/Off</th>
										</tr>
									</thead>
									<tbody>
									 
									</tbody>
								</table>
							</div>
						</div>        
					</div>
					<!-- Add Weekly Schedule Modal HTML -->
					<div id="addWeeklyScheduleModal" class="modal fade">
						<div class="modal-dialog">
							<div class="modal-content" id="addWeeklyScheduleModalContent">
								<form>
									<div class="modal-header">						
										<h4 class="modal-title">Create weekly schedules</h4>
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									</div>
									<div class="modal-body">					
										<div class="form-group">
											<label>Name</label>
											<!--input type="text" class="form-control" required-->
											<select name="weekly-progname" id="weekly-progname" required>
											</select>
										</div>
										<div class="form-group">
											<label>Frequency</label>
											<!--input type="text" class="form-control" required-->
											<select name="weekly-frequency" id="weekly-frequency" required>
												<option selected value="weekly">Weekly</option>
												<!--option value="monthly">Monthly</option>
												<option value="quarterly">Quarterly</option!-->
											</select>
										</div>
										<div class="form-group">
											<label>Time</label>
											<select name="weekly-time" id="weekly-time" required>
												<option value="17:00">17:00</option>
												<option value="18:00">18:00</option>
												<option value="19:00">19:00</option>
												<option value="20:00">20:00</option>
												<option value="21:00">21:00</option>
												<option value="22:00">22:00</option>
												<option value="23:00">23:00</option>
												<option value="00:00">00:00</option>
												<option value="01:00">01:00</option>
												<option value="02:00">02:00</option>
												<option value="03:00">03:00</option>
												<option value="04:00">04:00</option>
											</select>
										</div>				
									</div>
									<div class="modal-footer">
										<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
										<input type="button" class="btn btn-success" value="Save" id="addWeeklySchedulebtn" onclick="createDHISSchedule(this.id, document.getElementById('weekly-frequency').value)">
									</div>
								</form>
							</div>
						</div>
					</div>
					<!-- Edit Weekly Schedule Modal HTML -->
					<div id="editWeeklyScheduleModal" class="modal fade">
						<div class="modal-dialog">
							<div class="modal-content">
								<form>
									<div class="modal-header">						
										<h4 class="modal-title">Edit weekly schedules</h4>
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									</div>
									<div class="modal-body">					
										<div class="form-group">
											<label>Name</label>
											<input type="text" class="form-control" required>
										</div>
										<div class="form-group">
											<label>Email</label>
											<input type="email" class="form-control" required>
										</div>
										<div class="form-group">
											<label>Address</label>
											<textarea class="form-control" required></textarea>
										</div>
										<div class="form-group">
											<label>Phone</label>
											<input type="text" class="form-control" required>
										</div>					
									</div>
									<div class="modal-footer">
										<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
										<input type="submit" class="btn btn-info" value="Save">
									</div>
								</form>
							</div>
						</div>
					</div>
					<!-- Delete Weekly Schedule Modal HTML -->
					<div id="deleteWeeklyScheduleModal" class="modal fade">
						<div class="modal-dialog">
							<div class="modal-content">
								<form>
									<div class="modal-header">						
										<h4 class="modal-title">Delete weekly schedules</h4>
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									</div>
									<div class="modal-body">					
										<p>Are you sure you want to delete these schedules?</p>
										<p class="text-warning"><small>This action cannot be undone.</small></p>
									</div>
									<div class="modal-footer">
										<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
										<input type="button" class="btn btn-danger" value="Delete" id="deleteWeeklySchedulebtn" onclick="deleteDHISSchedule(this.id)">
									</div>
								</form>
							</div>
						</div>
					</div>

			</div>
			<!-- List Monthly Schedules HTML -->
			<div id="tab-monthly" class="tab-pane fade">
				<div class="container-xl">
					<div class="table-responsive">
						<div class="table-wrapper">
							<div class="table-title">
								<div class="row">
									<div class="col-sm-6">
										<h2>List of Monthly Schedules</h2>
									</div>
									<div class="col-sm-6">
										<a href="#addMonthlyScheduleModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>New</span></a>
										<a href="#deleteMonthlyScheduleModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a>
									</div>
								</div>
							</div>
							<table class="table table-striped table-hover" id="monthly-program-schedules">
								<thead>
									<tr>
										<th>
										</th>
										<th>Program</th>
										<th>Last Run</th>
										<th>Status</th>
										<th>On/Off</th>
									</tr>
								</thead>
								<tbody>
									
								</tbody>
							</table>
						</div>
					</div>        
				</div>
				<!-- Add Monthly Schedule Modal HTML -->
				<div id="addMonthlyScheduleModal" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content" id="addMonthlyScheduleModalContent">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Create monthly schedules</h4>
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">
									<!--div class="form-group">
										<label>Time:</label>
										<select name="monthly-time" id="monthly-time" required>
											<option value="17:00">17:00</option>
											<option value="18:00">18:00</option>
											<option value="19:00">19:00</option>
											<option value="20:00">20:00</option>
											<option value="21:00">21:00</option>
											<option value="22:00">22:00</option>
											<option value="23:00">23:00</option>
											<option value="00:00">00:00</option>
											<option value="01:00">01:00</option>
											<option value="02:00">02:00</option>
											<option value="03:00">03:00</option>
											<option value="04:00">04:00</option>
										</select>
									</div-->	
									<div class="form-group">
										<label>Reporting Periods:</label>
										<label for="datetime-picker">Select datetime of first period:</label>
										<input type="datetime-local" id="start-date" name="datetime-picker">

										<button class="btn btn-primary" id="generate-schedule">Generate Schedule</button>
										<div class="mt-4" id="schedule"></div>
									</div>
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
									<input type="button" class="btn btn-success" value="Save" id="addMonthlySchedulebtn" onclick="createDHISSchedule(this.id, document.getElementById('monthly-frequency').value)">
								</div>
							</form>
						</div>
					</div>
				</div>
				<!-- Edit Monthly Schedules Modal HTML -->
				<div id="editMonthlyScheduleModal" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Edit monthly schedules</h4>
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">					
									<div class="form-group">
										<label>Name</label>
										<input type="text" class="form-control" required>
									</div>
									<div class="form-group">
										<label>Email</label>
										<input type="email" class="form-control" required>
									</div>
									<div class="form-group">
										<label>Address</label>
										<textarea class="form-control" required></textarea>
									</div>
									<div class="form-group">
										<label>Phone</label>
										<input type="text" class="form-control" required>
									</div>					
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
									<input type="submit" class="btn btn-info" value="Save">
								</div>
							</form>
						</div>
					</div>
				</div>
				<!-- Delete Monthly Schedules Modal HTML -->
				<div id="deleteMonthlyScheduleModal" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Delete monthly schedules</h4>
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">					
									<p>Are you sure you want to delete these schedules?</p>
									<p class="text-warning"><small>This action cannot be undone.</small></p>
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
									<input type="submit" class="btn btn-danger" value="Delete" id="deleteMonthlySchedulebtn" onclick="deleteDHISSchedule(this.id)">
								</div>
							</form>
						</div>
					</div>
				</div>


			</div>
			<!-- List Quarterly Schedules HTML -->
			<div id="tab-quarterly" class="tab-quarterly tab-pane fade">
				<div class="container-xl">
					<div class="table-responsive">
						<div class="table-wrapper">
							<div class="table-title">
								<div class="row">
									<div class="col-sm-6">
										<h2>List of Quarterly Schedules</h2>
									</div>
									<div class="col-sm-6">
										<a href="#addQuarterlyScheduleModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>New</span></a>
										<a href="#deleteQuarterlyScheduleModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a>
									</div>
								</div>
							</div>
							<table class="table table-striped table-hover" id="quarterly-program-schedules">
								<thead>
									<tr>
										<th>
										</th>
										<th>Program</th>
										<th>Last Run</th>
										<th>Status</th>
										<th>On/Off</th>
									</tr>
								</thead>
								<tbody>
									
								</tbody>
							</table>
						</div>
					</div>        
				</div>
				<!-- Add Quarterly Schedules Modal HTML -->
				<div id="addQuarterlyScheduleModal" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Create quarterly schedules</h4>
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">					
									<div class="form-group">
										<label>Name</label>
										<!--input type="text" class="form-control" required-->
										<select name="quarterly-progname" id="quarterly-progname" required>
										</select>
									</div>
									<div class="form-group">
										<label>Frequency</label>
										<!--input type="text" class="form-control" required-->
										<select name="quarterly-frequency" id="quarterly-frequency" required>
											<!--option value="weekly">Weekly</option>
											<option value="monthly">Monthly</option!-->
											<option selected value="quarterly">Quarterly</option>
										</select>
									</div>
									<div class="form-group">
										<label>Time</label>
										<select name="quarterly-time" id="quarterly-time" required>
											<option value="17:00">17:00</option>
											<option value="18:00">18:00</option>
											<option value="19:00">19:00</option>
											<option value="20:00">20:00</option>
											<option value="21:00">21:00</option>
											<option value="22:00">22:00</option>
											<option value="23:00">23:00</option>
											<option value="00:00">00:00</option>
											<option value="01:00">01:00</option>
											<option value="02:00">02:00</option>
											<option value="03:00">03:00</option>
											<option value="04:00">04:00</option>
										</select>
									</div>				
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
									<input type="button" class="btn btn-success" value="Save" id="addQuarterlySchedulebtn" onclick="createDHISSchedule(this.id, document.getElementById('quarterly-frequency').value)">
								</div>
							</form>
						</div>
					</div>
				</div>
				<!-- Edit Quarterly Schedules Modal HTML -->
				<div id="editQuarterlyScheduleModal" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Edit quarterly schedules</h4>
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">					
									<div class="form-group">
										<label>Name</label>
										<input type="text" class="form-control" required>
									</div>
									<div class="form-group">
										<label>Email</label>
										<input type="email" class="form-control" required>
									</div>
									<div class="form-group">
										<label>Address</label>
										<textarea class="form-control" required></textarea>
									</div>
									<div class="form-group">
										<label>Phone</label>
										<input type="text" class="form-control" required>
									</div>					
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
									<input type="submit" class="btn btn-info" value="Save">
								</div>
							</form>
						</div>
					</div>
				</div>
				<!-- Delete Quarterly Schedules Modal HTML -->
				<div id="deleteQuarterlyScheduleModal" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Delete quarterly schedules</h4>
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">					
									<p>Are you sure you want to delete these schedules?</p>
									<p class="text-warning"><small>This action cannot be undone.</small></p>
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
									<input type="submit" class="btn btn-danger" value="Delete" id="deleteQuarterlySchedulebtn" onclick="deleteDHISSchedule(this.id)">
								</div>
							</form>
						</div>
					</div>
				</div>

				
			</div>
		</div>
	  
	</div>
	<script id="failure-status-template" type="x-tmpl-mustache">
    	<u class="status-failure">
        	<b>{{status}}</b>
   		</u>
	</script>
	<script id="failure-refresh-status-template" type="x-tmpl-mustache">
    	<b class="status-failure">{{status}}</b>
	</script>
	<script id="success-status-template" type="x-tmpl-mustache">
    	<b class="status-success">{{status}}</b>
	</script>
	<script id="success-refresh-status-template" type="x-tmpl-mustache">
    	<b class="status-success">{{status}}</b>
	</script>
</body>
</html>