<html>
<head>
<title>DHIS2 Integration App</title>
<style>
    .table-row {
      cursor: pointer;
    }

    .table-row .expand-icon::before {
      content: '+';
      display: inline-block;
      margin-right: 5px;
    }

    .table-row.collapsed .expand-icon::before {
      content: '-';
    }

    .hidden-row {
      display: none;
    }
  </style>

<!--LIBRARIES-->
<!--script src="https://code.jquery.com/jquery-3.5.1.min.js"></script-->
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="../bower_components/jquery.min/index.js"></script>
<script src="../bower_components/jquery-ui/jquery-ui.min.js"></script>

<!--PLUGINS-->
<!--script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script-->
<script src="../bower_components/mustache.min/index.js"></script>
<script src="../js/spinner.js"></script>
<script src="../js/initAutomation.js"></script>
<script src="../bower_components/nepali-date-picker/dist/jquery.nepaliDatePicker.min.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<!--STYLESHEETS AND FONTS-->
<link rel="stylesheet" href="../bower_components/nepali-date-picker/dist/nepaliDatePicker.min.css">
<link rel="stylesheet" href="../bower_components/jquery-ui/themes/base/jquery-ui.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<link rel="stylesheet" href="../css/stylesheet.css">

</head>
<body>
	<div class="header">
		<div class="dhisTitleWrapper">
			<div class="home">
				<a href="/bahmni/home" class="btn header-link">Home</a>
			</div>
			<div class="home">
				<a href="../index.html" class="btn header-link">Manual</a>
			</div>
            <div class="home">
				<a href="#" class="btn header-link">Automation</a>
			</div>
		</div>
	</div>

	<div class="dhisWrapper">
		<div id="tabs">
			<ul id="scheduler-tabs" class="nav nav-tabs">
				<li class="nav-item"><a href="#tab-clinical" class="nav-link active" data-toggle="tab">Clinical</a></li>
				<li class="nav-item"><a href="#tab-pharmacy" class="nav-link" data-toggle="tab">Pharmacy</a></li>
				<li class="nav-item"><a href="#tab-lab" class="nav-link" data-toggle="tab">Laboratory</a></li>
			</ul>
			<div id="tab-clinical" class="tab-pane fade show active">
					<div class="container-xl">
						<div class="table-responsive">
							<div class="table-wrapper">
								<div class="table-title">
									<div class="row">
										<div class="col-sm-6">
											<h2>Scheduled Clinical Reports</h2>
										</div>
										<div class="col-sm-6">
											<a href="#addClinicalScheduleModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>New</span></a>
											<a href="#deleteClinicalScheduleModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a>
										</div>
									</div>
								</div>
								<table class="table table-striped table-hover" id="clinical-program-schedules">
									<thead>
										<tr>
											<th>
											</th>
											<th>Report</th>
											<th>Frequency</th>
											<th>Last Run</th>
											<th>Status</th>
											<th>Next Run</th>
											<th>Enabled</th>
										</tr>
									</thead>
									<tbody>
									 
									</tbody>
								</table>
							</div>
						</div>        
					</div>
					<!-- Add Clinical Schedule Modal HTML -->
					<div id="addClinicalScheduleModal" class="modal fade">
						<div class="modal-dialog">
							<div class="modal-content" id="addClinicalScheduleModalContent">
								<form>
									<div class="modal-header">						
										<h4 class="modal-title">Create clinical schedules</h4>
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									</div>
									<div class="modal-body">					
										<div class="form-group">
											<label>Name:</label>
											<select name="clinical-report-name" id="clinical-report-name" required>
											</select>
										</div>
										<div class="form-group">
											<label>Frequency:</label>
											<!--input type="text" class="form-control" required-->
											<select name="clinical-frequency" id="clinical-frequency" required>
												<option selected value="weekly">Weekly</option>
												<option value="monthly">Monthly</option>
												<option value="quarterly">Quarterly</option>
											</select>
										</div>
										<div class="form-group">
											<label>Time:</label>
											<input type="time" id="clinical-time" name="clinical-time" value="09:00" required>
										</div>				
									</div>
									<div class="modal-footer">
										<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
										<input type="button" class="btn btn-success" value="Save" id="addClinicalSchedulebtn" onclick="createDHISSchedule(this.id, document.getElementById('clinical-frequency').value)">
									</div>
								</form>
							</div>
						</div>
					</div>
					<!-- Edit Clinical Schedule Modal HTML -->
					<div id="editClinicalScheduleModal" class="modal fade">
						<div class="modal-dialog">
							<div class="modal-content">
								<form>
									<div class="modal-header">						
										<h4 class="modal-title">Edit clinical schedules</h4>
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									</div>
									<div class="modal-body">					
										<div class="form-group">
											<label>Name</label>
											<input type="text" class="form-control" required>
										</div>
										<div class="form-group">
											<label>Email</label>
											<input type="email" class="form-control" required>
										</div>
										<div class="form-group">
											<label>Address</label>
											<textarea class="form-control" required></textarea>
										</div>
										<div class="form-group">
											<label>Phone</label>
											<input type="text" class="form-control" required>
										</div>					
									</div>
									<div class="modal-footer">
										<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
										<input type="submit" class="btn btn-info" value="Save">
									</div>
								</form>
							</div>
						</div>
					</div>
					<!-- Delete Clinical Schedule Modal HTML -->
					<div id="deleteClinicalScheduleModal" class="modal fade">
						<div class="modal-dialog">
							<div class="modal-content">
								<form>
									<div class="modal-header">						
										<h4 class="modal-title">Delete clinical schedules</h4>
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									</div>
									<div class="modal-body">					
										<p>Are you sure you want to delete these schedules?</p>
										<p class="text-warning"><small>This action cannot be undone.</small></p>
									</div>
									<div class="modal-footer">
										<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
										<input type="button" class="btn btn-danger" value="Delete" id="deleteClinicalSchedulebtn" onclick="deleteDHISSchedule(this.id)">
									</div>
								</form>
							</div>
						</div>
					</div>

			</div>
			<!-- List Pharmacy Schedules HTML -->
			<div id="tab-pharmacy" class="tab-pane fade">
				<div class="container-xl">
					<div class="table-responsive">
						<div class="table-wrapper">
							<div class="table-title">
								<div class="row">
									<div class="col-sm-6">
										<h2>Scheduled Pharmacy Reports</h2>
									</div>
									<div class="col-sm-6">
										<a href="#addPharmacyScheduleModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>New</span></a>
										<a href="#deletePharmacyScheduleModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a>
									</div>
								</div>
							</div>
							<table class="table table-striped table-hover" id="pharmacy-program-schedules">
								<thead>
									<tr>
										<th>
										</th>
										<th>Report</th>
										<th>Frequency</th>
										<th>Last Run</th>
										<th>Status</th>
										<th>Next Run</th>
										<th>Enabled</th>
									</tr>
								</thead>
							</table>
						</div>
					</div>        
				</div>
				<!-- Add Pharmacy Schedule Modal HTML -->
				<div id="addPharmacyScheduleModal" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content" id="addPharmacyScheduleModalContent">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Create pharmacy schedules</h4>
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">	
									<div class="form-group">
										<label>Name:</label>
										<!--input type="text" class="form-control" required-->
										<select name="pharmacy-report-name" id="pharmacy-report-name" required>
										</select>
									</div>
									<div class="form-group">
										<label>Frequency:</label>
										<select name="pharmacy-frequency" id="pharmacy-frequency" required>
											<option selected value="weekly">Weekly</option>
											<option selected value="monthly">Monthly</option>
											<option selected value="quarterly">Quarterly</option>
										</select>
									</div>
									<div class="form-group">
									<div id="is-custom-monthly-reporting-periods" style="display:none;">
										<label>Custom Reporting Periods?</label><input type="checkbox" name="myCheckbox" id="is-custom-monthly-reporting-periods-checkbox" value="checkbox"> 
									</div>
									</div>
									<div class="form-group">
										<div id="custom-monthly-reporting-periods-entry-table" style="display:none;">
										<label>Reporting Periods:</label>
										<div class="datetime-row">
											<label for="reporting_period1-start">Aug/Sept:</label>
											<label for="reporting_period1-start">Start:</label>
											<input type="date" id="reporting_period1-start" name="reporting_period1-start">
											<label for="reporting_period1-end">End:</label>
											<input type="date" id="reporting_period1-end" name="reporting_period1-end">
										  </div>
										  <div class="datetime-row">
											<label for="reporting_period2-start">Sept/Oct:</label>
											<label for="reporting_period2-start">Start:</label>
											<input type="date" id="reporting_period2-start" name="reporting_period2-start">
											<label for="reporting_period2-end">End:</label>
											<input type="date" id="reporting_period2-end" name="reporting_period2-end">
										  </div>
										  <div class="datetime-row">
											<label for="reporting_period3-start">Oct/Nov:</label>
											<label for="reporting_period3-start">Start:</label>
											<input type="date" id="reporting_period3-start" name="reporting_period3-start">
											<label for="reporting_period3-end">End:</label>
											<input type="date" id="reporting_period3-end" name="reporting_period3-end">
										  </div>
										  <div class="datetime-row">
											<label for="reporting_period4-start">Nov/Dec:</label>
											<label for="reporting_period4-start">Start:</label>
											<input type="date" id="reporting_period4-start" name="reporting_period4-start">
											<label for="reporting_period4-end">End:</label>
											<input type="date" id="reporting_period4-end" name="reporting_period4-end">
										  </div>
										  <div class="datetime-row">
											<label for="reporting_period5-start">Dec/Jan:</label>
											<label for="reporting_period5-start">Start:</label>
											<input type="date" id="reporting_period5-start" name="reporting_period5-start">
											<label for="reporting_period5-end">End:</label>
											<input type="date" id="reporting_period5-end" name="reporting_period5-end">
										  </div>
										  <div class="datetime-row">
											<label for="reporting_period6-start">Jan/Feb:</label>
											<label for="reporting_period6-start">Start:</label>
											<input type="date" id="reporting_period6-start" name="reporting_period6-start">
											<label for="reporting_period6-end">End:</label>
											<input type="date" id="reporting_period6-end" name="reporting_period6-end">
										  </div>
										  <div class="datetime-row">
											<label for="reporting_period7-start">Feb/Mar:</label>
											<label for="reporting_period7-start">Start:</label>
											<input type="date" id="reporting_period7-start" name="reporting_period7-start">
											<label for="reporting_period7-end">End:</label>
											<input type="date" id="reporting_period7-end" name="reporting_period7-end">
										  </div>
										  <div class="datetime-row">
											<label for="reporting_period8-start">Mar/Apr:</label>
											<label for="reporting_period8-start">Start:</label>
											<input type="date" id="reporting_period8-start" name="reporting_period8-start">
											<label for="reporting_period8-end">End:</label>
											<input type="date" id="reporting_period8-end" name="reporting_period8-end">
										  </div>
										  <div class="datetime-row">
											<label for="reporting_period9-start">Apr/May:</label>
											<label for="reporting_period9-start">Start:</label>
											<input type="date" id="reporting_period9-start" name="reporting_period9-start">
											<label for="reporting_period9-end">End:</label>
											<input type="date" id="reporting_period9-end" name="reporting_period9-end">
										  </div>
										  <div class="datetime-row">
											<label for="reporting_period10-start">May/June:</label>
											<label for="reporting_period10-start">Start:</label>
											<input type="date" id="reporting_period10-start" name="reporting_period10-start">
											<label for="reporting_period10-end">End:</label>
											<input type="date" id="reporting_period10-end" name="reporting_period10-end">
										  </div>
										  <div class="datetime-row">
											<label for="reporting_period11-start">June/July:</label>
											<label for="reporting_period11-start">Start:</label>
											<input type="date" id="reporting_period11-start" name="reporting_period11-start">
											<label for="reporting_period11-end">End:</label>
											<input type="date" id="reporting_period11-end" name="reporting_period11-end">
										  </div>
										  <div class="datetime-row">
											<label for="reporting_period12-start">July/Aug:</label>
											<label for="reporting_period12-start">Start:</label>
											<input type="date" id="reporting_period12-start" name="reporting_period12-start">
											<label for="reporting_period12-end">End:</label>
											<input type="date" id="reporting_period12-end" name="reporting_period12-end">
										  </div>
										  </div>
									</div>
									<div class="form-group">
										<label>Time:</label>
										<input type="time" id="pharmacy-time" name="pharmacy-time" value="09:00" required>
									</div>	
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
									<input type="button" class="btn btn-success" value="Save" id="addPharmacySchedulebtn" onclick="createDHISSchedule(this.id, document.getElementById('pharmacy-frequency').value)">
								</div>
							</form>
						</div>
					</div>
				</div>
				<!-- Edit Pharmacy Schedules Modal HTML -->
				<div id="editPharmacyScheduleModal" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Edit pharmacy schedules</h4>
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">					
									<div class="form-group">
										<label>Name</label>
										<input type="text" class="form-control" required>
									</div>
									<div class="form-group">
										<label>Email</label>
										<input type="email" class="form-control" required>
									</div>
									<div class="form-group">
										<label>Address</label>
										<textarea class="form-control" required></textarea>
									</div>
									<div class="form-group">
										<label>Phone</label>
										<input type="text" class="form-control" required>
									</div>					
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
									<input type="submit" class="btn btn-info" value="Save">
								</div>
							</form>
						</div>
					</div>
				</div>
				<!-- Delete Pharmacy Schedules Modal HTML -->
				<div id="deletePharmacyScheduleModal" class="modal">
					<div class="modal-dialog">
						<div class="modal-content">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Delete pharmacy schedules</h4>
									<button type="button" class="close" data-dismiss="modal" id="closeDeletePharmacySchedulebtn" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">		
									<p class="delete-schedule-msg">Are you sure you want to delete these schedules?</p>
									<p class="text-warning"><small>This action cannot be undone.</small></p>
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" id="cancelDeletePharmacySchedulebtn" value="Cancel">
									<input type="submit" class="btn btn-danger" value="Delete" id="deletePharmacySchedulebtn" onclick="deleteDHISSchedule(this.id)">
								</div>
							</form>
						</div>
						<script>
							var clicked_element_id='deletePharmacyScheduleLink';
							//console.log(clicked_element_id);
							if(clicked_element_id!=null){
								var modal;
								var programCategory;
								var msg;
								var paragraph;

								//select the right modal to display and the paragraph element to update
								if(clicked_element_id=='deletePharmacyScheduleLink'){
									modal = document.getElementById('deletePharmacyScheduleModal');
									programCategory="pharmacy";
									paragraph = document.querySelector('#deletePharmacyScheduleModal .delete-schedule-msg');

								}
								else if(clicked_element_id=='deleteClinicalScheduleLink'){
									modal = document.getElementById('deleteClinicalScheduleModal');
									programCategory="clinical";
									paragraph = document.querySelector('#deleteClinicalScheduleModal .delete-schedule-msg');
								}
								else if(clicked_element_id=='deleteLabScheduleLink'){
									modal = document.getElementById('deleteLabScheduleModal');
									programCategory="lab";
									paragraph = document.querySelector('#deleteLabScheduleModal .delete-schedule-msg');
								}

								//select the right message to display
								var flag = isProgramScheduleSelected(programCategory);
								console.log('[handleDeleteScheduleEvent] flag='+flag);
								if(flag){
									console.log('[handleDeleteScheduleEvent] atleast one schedule selected!');
									msg="Are you sure you want to delete these schedules?";
									paragraph.textContent=msg;
								}
								else{
									console.log('[handleDeleteScheduleEvent] No schedule selected!');
									msg="No schedule selected for deletion. Select schedule(s) to delete using the checkboxes on the left.";
									paragraph.textContent=msg;
								}

								//$("#deletePharmacyScheduleModal").find('.btn-default, .close').off('click').on('click', function() {
									//$("#deletePharmacyScheduleModal").modal('hide');
								//	modal.classList.add('hide');
									//modal.style.display = 'block';
								//	console.log('[handleDeleteScheduleEvent] onclick event handlder added for cancel and close buttons!');
								//});
								//enable cancel button
								//$("#deletePharmacyScheduleModal").find('.btn-default').prop('disabled', false);
								//enable close button
								//$("#deletePharmacyScheduleModal").find('.close').prop('disabled', false);
								//display the right modal with the right message
								//modal.classList.add('show');
								//modal.style.display = 'block';
								//modal.modal('show');
								//var selectModalbyId="#"+modal;
								//$(modal).modal('show');
								// Re-bind event handlers for cancel and close buttons
								
							
							}
						</script>
					</div>
				</div>


			</div>
			<!-- List Lab Schedules HTML -->
			<div id="tab-lab" class="tab-lab tab-pane fade">
				<div class="container-xl">
					<div class="table-responsive">
						<div class="table-wrapper">
							<div class="table-title">
								<div class="row">
									<div class="col-sm-6">
										<h2>Scheduled Laboratory Reports</h2>
									</div>
									<div class="col-sm-6">
										<a href="#addLabScheduleModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>New</span></a>
										<a href="#deleteLabScheduleModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a>
									</div>
								</div>
							</div>
							<table class="table table-striped table-hover" id="lab-program-schedules">
								<thead>
									<tr>
										<th>
										</th>
										<th>Report</th>
										<th>Frequency</th>
										<th>Last Run</th>
										<th>Status</th>
										<th>Next Run</th>
										<th>Enabled</th>
									</tr>
								</thead>
								<tbody>
									
								</tbody>
							</table>
						</div>
					</div>        
				</div>
				<!-- Add Lab Schedules Modal HTML -->
				<div id="addLabScheduleModal" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Create lab schedules</h4>
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">					
									<div class="form-group">
										<label>Name:</label>
										<!--input type="text" class="form-control" required-->
										<select name="lab-report-name" id="lab-report-name" required>
										</select>
									</div>
									<div class="form-group">
										<label>Frequency:</label>
										<!--input type="text" class="form-control" required-->
										<select name="lab-frequency" id="lab-frequency" required>
											<option value="weekly">Weekly</option>
											<option value="monthly">Monthly</option>
											<option selected value="quarterly">Quarterly</option>
										</select>
									</div>
									<div class="form-group">
										<label>Time:</label>
										<input type="time" id="lab-time" name="lab-time" value="09:00" required>
									</div>				
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
									<input type="button" class="btn btn-success" value="Save" id="addLabSchedulebtn" onclick="createDHISSchedule(this.id, document.getElementById('lab-frequency').value)">
								</div>
							</form>
						</div>
					</div>
				</div>
				<!-- Edit Lab Schedules Modal HTML -->
				<div id="editLabScheduleModal" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Edit lab schedules</h4>
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">					
									<div class="form-group">
										<label>Name</label>
										<input type="text" class="form-control" required>
									</div>
									<div class="form-group">
										<label>Email</label>
										<input type="email" class="form-control" required>
									</div>
									<div class="form-group">
										<label>Address</label>
										<textarea class="form-control" required></textarea>
									</div>
									<div class="form-group">
										<label>Phone</label>
										<input type="text" class="form-control" required>
									</div>					
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
									<input type="submit" class="btn btn-info" value="Save">
								</div>
							</form>
						</div>
					</div>
				</div>
				<!-- Delete Lab Schedules Modal HTML -->
				<div id="deleteLabScheduleModal" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<form>
								<div class="modal-header">						
									<h4 class="modal-title">Delete lab schedules</h4>
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>
								<div class="modal-body">					
									<p>Are you sure you want to delete these schedules?</p>
									<p class="text-warning"><small>This action cannot be undone.</small></p>
								</div>
								<div class="modal-footer">
									<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
									<input type="submit" class="btn btn-danger" value="Delete" id="deleteLabSchedulebtn" onclick="deleteDHISSchedule(this.id)">
								</div>
							</form>
						</div>
					</div>
				</div>

				
			</div>
		</div>
	  
	</div>
	<script id="failure-status-template" type="x-tmpl-mustache">
    	<u class="status-failure">
        	<b>{{status}}</b>
   		</u>
	</script>
	<script id="failure-refresh-status-template" type="x-tmpl-mustache">
    	<b class="status-failure">{{status}}</b>
	</script>
	<script id="success-status-template" type="x-tmpl-mustache">
    	<b class="status-success">{{status}}</b>
	</script>
	<script id="success-refresh-status-template" type="x-tmpl-mustache">
    	<b class="status-success">{{status}}</b>
	</script>
</body>
</html>